# OLED Bootloader Display Integration Plan

## Overview

Add SSD1306 OLED display support via I2C (GPIO21/GPIO22) to display bootloader information, application details, boot progress, and partition information during ESP32 startup.

## Implementation Steps

### 1. Add Dependencies (Cargo.toml)

- Add `ssd1306` crate with `i2c` feature for embedded-hal compatibility
- Add `embedded-graphics` for text rendering (or use simpler text-only approach)
- Ensure `esp-hal` has I2C support enabled (should be included with "esp32" feature)

### 2. Create I2C Module (src/i2c.rs)

- Initialize I2C0 peripheral on ESP32
- Configure GPIO21 (SDA) and GPIO22 (SCL) for I2C
- Set I2C clock speed (typically 100kHz or 400kHz for SSD1306)
- Return configured I2C driver instance

### 3. Create OLED Module (src/oled.rs)

- Initialize SSD1306 display with I2C interface
- Create display functions:
    - `init()` - Initialize display and clear screen
    - `clear()` - Clear display buffer
    - `show_boot_progress(message: &str)` - Display boot progress messages
    - `show_app_info()` - Display application descriptor info
    - `show_partition_info()` - Display partition table information
- Handle text rendering (simple character-based or embedded-graphics)

### 4. Read Bootloader/App Information

- Use `esp_bootloader_esp_idf` to access app descriptor:
    - App name, version, compile date/time
    - Project name, version
- Access partition information via bootloader APIs
- Format information for display on 128x64 OLED

### 5. Update Main Function (src/main.rs)

- Initialize I2C before other peripherals
- Initialize OLED display early in boot sequence
- Display boot progress messages:
    - "Initializing I2C..."
    - "Initializing OLED..."
    - "Reading bootloader info..."
    - "System ready"
- Display app descriptor information
- Display partition information
- Integrate OLED updates into main loop (optional status updates)

### 6. Module Structure

```
src/
  - i2c.rs      (I2C initialization)
  - oled.rs     (SSD1306 driver wrapper)
  - main.rs     (Updated with OLED integration)
```

## Key Files to Modify

- `Cargo.toml` - Add ssd1306 and embedded-graphics dependencies
- `src/main.rs` - Add OLED initialization and display calls
- `src/i2c.rs` - New file for I2C setup
- `src/oled.rs` - New file for OLED display functions

## Technical Considerations

- SSD1306 I2C address: typically 0x3C (or 0x3D)
- Display size: 128x64 pixels
- Text rendering: Use simple bitmap font or embedded-graphics
- Boot sequence: Display info early, before main loop
- Memory: Keep display buffers minimal for no_std environment